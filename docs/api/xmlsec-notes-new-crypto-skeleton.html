<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Creating a framework from the skeleton.</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="XML Security Library Reference Manual"
HREF="index.html"><LINK
REL="UP"
TITLE="Adding support for new cryptographic library."
HREF="xmlsec-notes-new-crypto.html"><LINK
REL="PREVIOUS"
TITLE="Adding support for new cryptographic library."
HREF="xmlsec-notes-new-crypto.html"><LINK
REL="NEXT"
TITLE="xmlSecCryptoApp* functions."
HREF="xmlsec-notes-new-crypto-functions.html"><STYLE
TYPE="text/css"
>.synopsis, .classsynopsis {
    background: #eeeeee;
    border: solid 1px #aaaaaa;
    padding: 0.5em;
}
.programlisting {
    background: #eeeeff;
    border: solid 1px #aaaaff;
    padding: 0.5em;
}
.variablelist {
    padding: 4px;
    margin-left: 3em;
}
.navigation {
    background: #ffeeee;
    border: solid 1px #ffaaaa;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}
.navigation a {
    color: #770000;
}
.navigation a:visited {
    color: #550000;
}
.navigation .title {
    font-size: 200%;
}</STYLE
></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><TABLE
WIDTH="100%"
CLASS="navigation"
SUMMARY="Navigation header"
CELLPADDING="2"
CELLSPACING="2"
><TR
VALIGN="middle"
><TD
><A
ACCESSKEY="p"
HREF="xmlsec-notes-new-crypto.html"
><IMG
SRC="left.png"
WIDTH="16"
HEIGHT="16"
BORDER="0"
ALT="Prev"></A
></TD
><TD
><A
ACCESSKEY="u"
HREF="xmlsec-notes-new-crypto.html"
><IMG
SRC="up.png"
WIDTH="16"
HEIGHT="16"
BORDER="0"
ALT="Up"></A
></TD
><TD
><A
ACCESSKEY="h"
HREF="index.html"
><IMG
SRC="home.png"
WIDTH="16"
HEIGHT="16"
BORDER="0"
ALT="Home"></A
></TD
><TH
WIDTH="100%"
align="center"
>XML Security Library Reference Manual</TH
><TD
><A
ACCESSKEY="n"
HREF="xmlsec-notes-new-crypto-functions.html"
><IMG
SRC="right.png"
WIDTH="16"
HEIGHT="16"
BORDER="0"
ALT="Next"></A
></TD
></TR
></TABLE
><BR
CLEAR="all"><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="XMLSEC-NOTES-NEW-CRYPTO-SKELETON"
>Creating a framework from the skeleton.</A
></H1
><P
>	The XML Security Library contains a "skeleton" for creating new
	"xmlsec-&lt;crypto&gt;" libraries. In order to create "xmlsec-mycrypto"
	library framework, do the following (this example assumes that you 
	are using *nix system, adjust the commands if you are using something else):
	<P
></P
><UL
><LI
><P
>	Copy src/skeleton and include/xmlsec/skeleton folders to src/mycrypto and
	include/xmlsec/mycrypto folders:
	<DIV
CLASS="EXAMPLE"
><A
NAME="AEN512"
></A
><P
><B
>Example 1. Coping skeleton folders:</B
></P
><PRE
CLASS="PROGRAMLISTING"
>cp -r src/skeleton src/mycrypto
cp -r include/xmlsec/skeleton include/xmlsec/mycrypto
	    </PRE
></DIV
>	
	</P
></LI
><LI
><P
>	Replace "skeleton" with "mycrypto" in the copied files (note that there
	are different possible cases here):
	<DIV
CLASS="EXAMPLE"
><A
NAME="AEN517"
></A
><P
><B
>Example 2. Replacing "skeleton" with "mycrypto".</B
></P
><PRE
CLASS="PROGRAMLISTING"
>for i in `ls include/xmlsec/mycrypto/* src/mycrypto/*`;  do 
    echo Processing $i ..;
    sed 's/skeleton/mycrypto/g' $i | \
    sed 's/SKELETON/MYCRYPTO/g' | \
    sed 's/Skeleton/MyCrypto/g' &#62; $i.tmp;
    mv $i.tmp $i;
done
	    </PRE
></DIV
>
	</P
></LI
><LI
><P
>	Add "xmlsec-mycrypto" library to the "include/xmlsec/crypto.h" file:
	<DIV
CLASS="EXAMPLE"
><A
NAME="AEN522"
></A
><P
><B
>Example 3. Modifying include/xmlsec/crypto.h file.</B
></P
><PRE
CLASS="PROGRAMLISTING"
>...	    
#ifdef XMLSEC_CRYPTO_MYCRYPTO
#include &#60;xmlsec/mycrypto/app.h&#62;
#include &#60;xmlsec/mycrypto/crypto.h&#62;
#include &#60;xmlsec/mycrypto/symbols.h&#62;
#else /* XMLSEC_CRYPTO_MYCRYPTO */
...
#endif /* XMLSEC_CRYPTO_MYCRYPTO */
...
	    </PRE
></DIV
>
	</P
></LI
><LI
><P
>	Add "xmlsec-crypto" library to the configure.in file (for *nix systems;
	for Windows you need to modify win32/confgure.js and win32/Makefile.msvc
	files, see win32/README.txt for details):
	<DIV
CLASS="EXAMPLE"
><A
NAME="AEN527"
></A
><P
><B
>Example 4. Modifying configure.in file.</B
></P
><PRE
CLASS="PROGRAMLISTING"
>dnl ==========================================================================
dnl See if we can find MyCrypto
dnl ==========================================================================
XMLSEC_MYCRYPTO_DEFINES=""
MYCRYPTO_CONFIG="mycrypto-config" # TODO
XMLSEC_NO_MYCRYPTO="1"
MYCRYPTO_MIN_VERSION="0.0.0" # TODO 
MYCRYPTO_VERSION=""
MYCRYPTO_PREFIX=""
MYCRYPTO_CFLAGS=""
MYCRYPTO_LIBS=""
MYCRYPTO_LDADDS=""
AC_MSG_CHECKING(for mycrypto libraries &#62;= $MYCRYPTO_MIN_VERSION) 
AC_ARG_WITH(mycrypto, [  --with-mycrypto=[PFX]    mycrypto location])
if test "$with_mycrypto" = "no" ; then
    XMLSEC_CRYPTO_DISABLED_LIST="$XMLSEC_CRYPTO_DISABLED_LIST mycrypto"
    AC_MSG_RESULT(no)
else
    if test "$with_mycrypto" != "" ; then
	MYCRYPTO_PREFIX=$with_mycrypto
	MYCRYPTO_CONFIG=$MYCRYPTO_PREFIX/bin/$MYCRYPTO_CONFIG
    fi
    if ! $MYCRYPTO_CONFIG --version &#62; /dev/null 2&#62;&#38;1 ; then
	if test "$with_mycrypto" != "" ; then
	    AC_MSG_ERROR(Unable to find mycrypto at '$with_mycrypto')
	fi
    else
        vers=`$MYCRYPTO_CONFIG --version | awk -F. '{ printf "%d", ($1 * 1000 + $2) * 1000 + $3;}'`
	minvers=`echo $MYCRYPTO_MIN_VERSION | awk -F. '{ printf "%d", ($1 * 1000 + $2) * 1000 + $3;}'`
	if test "$vers" -ge "$minvers" ; then
    	    MYCRYPTO_LIBS="`$MYCRYPTO_CONFIG --libs`"
	    MYCRYPTO_CFLAGS="`$MYCRYPTO_CONFIG --cflags`"
	    MYCRYPTO_VERSION="`$MYCRYPTO_CONFIG --version`"
	    XMLSEC_NO_MYCRYPTO="0"
	else
    	    AC_MSG_ERROR(You need at least mycrypto $MYCRYPTO_MIN_VERSION for this version of $PACKAGE)
	fi	
    fi

    dnl update crypt libraries list
    if test "z$XMLSEC_NO_MYCRYPTO" = "z0" ; then
	dnl first crypto library is default one
	if test "z$XMLSEC_CRYPTO" = "z" ; then
	    XMLSEC_CRYPTO="mycrypto"
    	    XMLSEC_CRYPTO_LIB="xmlsec1-mycrypto"
	    XMLSEC_CRYPTO_CFLAGS="$MYCRYPTO_CFLAGS -DXMLSEC_CRYPTO_MYCRYPTO=1"
	    XMLSEC_CRYPTO_LIBS="$MYCRYPTO_LIBS"
	    XMLSEC_CRYPTO_LDADDS="$MYCRYPTO_LDADDS"
	fi	
	XMLSEC_CRYPTO_LIST="$XMLSEC_CRYPTO_LIST mycrypto"
    	AC_MSG_RESULT(yes ('$MYCRYPTO_VERSION'))
    else
	XMLSEC_CRYPTO_DISABLED_LIST="$XMLSEC_CRYPTO_DISABLED_LIST mycrypto"
	AC_MSG_RESULT(no)
    fi
fi
AC_SUBST(XMLSEC_NO_MYCRYPTO)
AC_SUBST(MYCRYPTO_MIN_VERSION)
AC_SUBST(MYCRYPTO_VERSION)
AC_SUBST(MYCRYPTO_CONFIG)	
AC_SUBST(MYCRYPTO_PREFIX)
AC_SUBST(MYCRYPTO_CFLAGS)
AC_SUBST(MYCRYPTO_LIBS)
AC_SUBST(MYCRYPTO_LDADDS)
AC_SUBST(XMLSEC_MYCRYPTO_DEFINES)

...
AC_OUTPUT([
...
include/xmlsec/mycrypto/Makefile
src/mycrypto/Makefile
...
])
	    </PRE
></DIV
>
	</P
></LI
><LI
><P
>Modify "xmlsec.spec.in" file to create "xmlsec-mycrypto"
	RPM (if necessary).
	</P
></LI
></UL
>
	
	By now you should be able to sucessfuly compile XML Security Library
	with MyCrypto library (we disable all other libraries to make sure
	that xmlsec command line utility is linked against xmlsec-mycrypto
	library):
	<DIV
CLASS="EXAMPLE"
><A
NAME="AEN532"
></A
><P
><B
>Example 5. Compiling the results.</B
></P
><PRE
CLASS="PROGRAMLISTING"
>./autogen.sh --without-openssl --without-nss --without-gnutls --without-gcrypt \
    	     --with-mycrypto=$HOME --disable-tmpl-tests
make	
	    </PRE
></DIV
>
	</P
></DIV
><TABLE
CLASS="navigation"
WIDTH="100%"
SUMMARY="Navigation footer"
CELLPADDING="2"
CELLSPACING="2"
><TR
VALIGN="middle"
><TD
ALIGN="left"
><A
ACCESSKEY="p"
HREF="xmlsec-notes-new-crypto.html"
><B
>&lt;&lt;&lt;&nbsp;Adding support for new cryptographic library.</B
></A
></TD
><TD
ALIGN="right"
><A
ACCESSKEY="n"
HREF="xmlsec-notes-new-crypto-functions.html"
><B
>xmlSecCryptoApp* functions.&nbsp;&gt;&gt;&gt;</B
></A
></TD
></TR
></TABLE
></BODY
></HTML
>